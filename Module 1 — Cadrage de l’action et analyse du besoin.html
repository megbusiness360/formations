<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Labo des Méthodes Actives</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Plain JavaScript (Bypasses React Dependency issue) -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script> 

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600&family=Roboto:wght@400;500;700&display=swap');
        body { font-family: 'Roboto', sans-serif; background-color: #f3f4f6; }
        h1, h2, h3, button { font-family: 'Fredoka', sans-serif; }
        .card-enter { animation: slideIn 0.5s ease-out; }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .shake { animation: shake 0.5s; }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 40% { transform: translate(1px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); } 70% { transform: translate(3px, 1px) rotate(-1deg); } 80% { transform: translate(-1px, -1px) rotate(1deg); } 90% { transform: translate(1px, 2px) rotate(0deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }
        .animate-pop { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Fonction utilitaire pour créer/rafraîchir les icônes Lucide après le rendu React
        const refreshIcons = () => {
            if (window.lucide && window.lucide.createIcons) {
                window.lucide.createIcons();
            }
        };

        // Hook pour rafraîchir les icônes après le rendu
        const useLucideRefresh = (deps = []) => {
            useEffect(() => {
                refreshIcons();
            }, deps);
        };

        // --- DONNÉES DU JEU ---

        const sortData = [
            { id: 1, text: "L'apprenant écoute et prend des notes", type: "passive", feedback: "C'est une méthode transmissive classique." },
            { id: 2, text: "Les erreurs sont des opportunités d'apprentissage", type: "active", feedback: "Exact ! Dans les méthodes actives, l'erreur permet de progresser." },
            { id: 3, text: "L'apprenant manipule et expérimente", type: "active", feedback: "Oui, c'est le cœur de la méthode : l'action." },
            { id: 4, text: "Le formateur détient tout le savoir", type: "passive", feedback: "Non, en méthode active, le formateur est un guide/facilitateur." },
            { id: 5, text: "Réflexion systématique sur l'action (Débriefing)", type: "active", feedback: "Essentiel pour transformer l'expérience en compétence." },
            { id: 6, text: "Application immédiate au contexte pro", type: "active", feedback: "Le transfert est facilité par des situations authentiques." }
        ];

        const matchData = [
            { level: "Créer / Concevoir", method: "Pédagogie de projet", iconName: "puzzle" },
            { level: "Appliquer / Utiliser", method: "Atelier pratique / Simulation", iconName: "layout" },
            { level: "Évaluer / Juger", method: "Étude de cas complexe / Débat", iconName: "message-square" },
            { level: "Connaître / Mémoriser", method: "Quiz interactif / Ludification", iconName: "brain" }
        ];

        const scenarios = [
            {
                context: "Formation Commerce - Négociation Difficile",
                detail: "Public expérimenté. Objectif : Gérer l'agressivité client.",
                question: "Quelle est la meilleure méthode ?",
                options: [
                    { text: "Lecture de diapositives sur l'agressivité", correct: false, feedback: "Trop théorique pour une compétence comportementale." },
                    { text: "Jeu de rôle avec débriefing vidéo", correct: true, feedback: "Parfait pour travailler le comportemental et le 'savoir-être' en sécurité." },
                    { text: "Travail de groupe sur la définition de l'agressivité", correct: false, feedback: "Intellectuel, mais ne développe pas le réflexe face au client." }
                ]
            },
            {
                context: "Formation Logiciel - Grands Débutants",
                detail: "Public hétérogène. Objectif : Savoir saisir une facture.",
                question: "Quelle méthode privilégier ?",
                options: [
                    { text: "Atelier pratique guidé pas-à-pas", correct: true, feedback: "Pour un geste technique (savoir-faire), il faut pratiquer immédiatement." },
                    { text: "Étude de cas sur la comptabilité", correct: false, feedback: "Trop complexe pour des débutants qui ne connaissent pas l'outil." },
                    { text: "Brainstorming sur l'utilité du logiciel", correct: false, feedback: "Intéressant pour la motivation, mais n'enseigne pas la compétence technique." }
                ]
            },
            {
                context: "Formation Management - Cohésion d'équipe",
                detail: "Équipe en conflit. Objectif : Apprendre à travailler ensemble.",
                question: "Quelle méthode pour engager tout le monde ?",
                options: [
                    { text: "Cours magistral sur le leadership", correct: false, feedback: "Passif. Ne résoudra pas les conflits." },
                    { text: "Pédagogie de projet (Défi collectif)", correct: true, feedback: "Réaliser une production commune force la coopération et l'autonomie." },
                    { text: "Quiz individuel", correct: false, feedback: "Trop individualiste pour un objectif de cohésion." }
                ]
            }
        ];

        // --- COMPOSANTS UTILITAIRES ---

        const Icon = ({ name, size = 24, className = "" }) => (
            <i data-lucide={name} data-size={size} className={className}></i>
        );

        const Button = ({ onClick, children, variant = "primary", className = "" }) => {
            const baseStyle = "px-6 py-3 rounded-xl font-bold text-lg shadow-lg transform transition hover:scale-105 active:scale-95 flex items-center justify-center gap-2";
            const variants = {
                primary: "bg-blue-600 text-white hover:bg-blue-700",
                secondary: "bg-white text-gray-800 border-2 border-gray-200 hover:border-blue-500",
                success: "bg-green-500 text-white",
                danger: "bg-red-500 text-white",
                neutral: "bg-indigo-100 text-indigo-700 hover:bg-indigo-200"
            };
            return (
                <button onClick={onClick} className={\`${baseStyle} ${variants[variant]} ${className}\`}>
                    {children}
                </button>
            );
        };

        const CheckCircleComp = ({className, size}) => <div className={\`rounded-full border-4 border-green-500 p-2 ${className}\`}><Icon name="check" size={size}/></div>;
        const XCircleComp = ({className, size}) => <div className={\`rounded-full border-4 border-red-500 p-2 ${className}\`}><Icon name="x" size={size}/></div>;

        // --- ÉCRANS DE JEU ---

        const Intro = ({ onStart }) => {
            useLucideRefresh();
            return (
                <div className="flex flex-col items-center justify-center min-h-screen p-6 text-center bg-gradient-to-br from-indigo-500 to-purple-600 text-white">
                    <div className="bg-white/20 p-8 rounded-full mb-6 backdrop-blur-sm animate-pulse">
                        <Icon name="brain" size={80} />
                    </div>
                    <h1 className="text-5xl font-bold mb-4">Le Labo des Méthodes</h1>
                    <p className="text-xl mb-8 max-w-lg">
                        Maîtrisez l'art de concevoir des activités pédagogiques engageantes.
                        <br/><br/>
                        <span className="text-sm bg-white/20 px-3 py-1 rounded-full">Basé sur le Module 5</span>
                    </p>
                    
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-10 w-full max-w-2xl">
                        <div className="bg-white/10 p-4 rounded-xl backdrop-blur-sm">
                            <Icon name="zap" className="mx-auto mb-2" />
                            <h3 className="font-bold">Identifier</h3>
                            <p className="text-xs opacity-80">Actif vs Passif</p>
                        </div>
                        <div className="bg-white/10 p-4 rounded-xl backdrop-blur-sm">
                            <Icon name="target" className="mx-auto mb-2" />
                            <h3 className="font-bold">Aligner</h3>
                            <p className="text-xs opacity-80">Objectifs & Méthodes</p>
                        </div>
                        <div className="bg-white/10 p-4 rounded-xl backdrop-blur-sm">
                            <Icon name="briefcase" className="mx-auto mb-2" />
                            <h3 className="font-bold">Sélectionner</h3>
                            <p className="text-xs opacity-80">Mise en situation</p>
                        </div>
                    </div>

                    <Button onClick={onStart} variant="secondary">
                        <Icon name="arrow-right" /> Commencer l'expérience
                    </Button>
                </div>
            );
        };

        const Level1Sorter = ({ onComplete }) => {
            const [index, setIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [feedback, setFeedback] = useState(null);

            useLucideRefresh([index, feedback]);

            const handleChoice = (type) => {
                if(feedback) return; // Prevent multiple clicks
                const currentItem = sortData[index];
                const isCorrect = currentItem.type === type;
                
                setFeedback({
                    correct: isCorrect,
                    text: isCorrect ? "Bien vu ! " + currentItem.feedback : "Oups ! " + currentItem.feedback
                });

                if (isCorrect) setScore(s => s + 1);
            };

            const nextCard = () => {
                setFeedback(null);
                if (index < sortData.length - 1) {
                    setIndex(i => i + 1);
                } else {
                    onComplete(score, sortData.length);
                }
            };

            const currentCard = sortData[index];

            return (
                <div className="max-w-2xl mx-auto pt-10 px-4">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold text-gray-800 flex items-center gap-2"><Icon name="zap" className="text-yellow-500"/> Phase 1 : Le Trieur</h2>
                        <span className="font-bold text-indigo-600">{index + 1}/{sortData.length}</span>
                    </div>
                    
                    <div className="bg-white rounded-3xl shadow-xl p-8 min-h-[300px] flex flex-col justify-center items-center text-center card-enter relative overflow-hidden">
                        {!feedback ? (
                            <>
                                <p className="text-slate-500 text-sm uppercase tracking-widest mb-4">Caractéristique</p>
                                <h3 className="text-3xl font-bold text-gray-800 mb-10 leading-tight">"{currentCard.text}"</h3>
                                
                                <div className="grid grid-cols-2 gap-6 w-full">
                                    <button 
                                        onClick={() => handleChoice('active')}
                                        className="py-6 rounded-2xl bg-green-100 text-green-700 font-bold hover:bg-green-200 transition text-xl flex flex-col items-center"
                                    >
                                        <Icon name="zap" size={32} className="mb-2"/> Méthode ACTIVE
                                    </button>
                                    <button 
                                        onClick={() => handleChoice('passive')}
                                        className="py-6 rounded-2xl bg-gray-100 text-gray-600 font-bold hover:bg-gray-200 transition text-xl flex flex-col items-center"
                                    >
                                        <Icon name="clock" size={32} className="mb-2"/> Méthode PASSIVE
                                    </button>
                                </div>
                            </>
                        ) : (
                            <div className="animate-pop">
                                {feedback.correct ? 
                                    <CheckCircleComp className="text-green-500 mx-auto mb-4" size={64} /> : 
                                    <XCircleComp className="text-red-500 mx-auto mb-4" size={64} />
                                }
                                <p className={\`text-xl font-bold mb-2 ${feedback.correct ? 'text-green-600' : 'text-red-600'}\`}>
                                    {feedback.correct ? "Correct !" : "Erreur !"}
                                </p>
                                <p className="text-gray-600 mb-8 text-lg">{feedback.text}</p>
                                <Button onClick={nextCard} variant="primary">Continuer</Button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const Level2Matcher = ({ onComplete }) => {
            const [selectedLevel, setSelectedLevel] = useState(null);
            const [matches, setMatches] = useState({}); 
            const [score, setScore] = useState(0);

            useLucideRefresh([selectedLevel, matches]);

            const handleLevelClick = (level) => {
                if (matches[level]) return; 
                setSelectedLevel(level);
            };

            const handleMethodClick = (method) => {
                if (!selectedLevel) return;
                const correctPair = matchData.find(d => d.level === selectedLevel && d.method === method);
                
                if (correctPair) {
                    setMatches(prev => ({ ...prev, [selectedLevel]: method }));
                    setScore(s => s + 1);
                    setSelectedLevel(null);
                } else {
                    const el = document.getElementById('grid-container');
                    if(el) {
                        el.classList.add('shake');
                        setTimeout(() => el.classList.remove('shake'), 500);
                    }
                    setSelectedLevel(null);
                }
            };

            useEffect(() => {
                if (Object.keys(matches).length === matchData.length) {
                    setTimeout(() => onComplete(score, matchData.length), 1500);
                }
            }, [matches]);

            return (
                <div className="max-w-4xl mx-auto pt-10 px-4">
                    <h2 className="text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2">
                        <Icon name="target" className="text-purple-500"/> Phase 2 : Alignement C2
                    </h2>
                    <p className="text-gray-600 mb-6">Reliez le niveau d'apprentissage (Bloom) à la méthode appropriée.</p>

                    <div id="grid-container" className="grid grid-cols-2 gap-8">
                        <div className="space-y-4">
                            <h3 className="font-bold text-gray-400 uppercase text-sm">Niveau Cognitif</h3>
                            {matchData.map((item) => (
                                <button
                                    key={item.level}
                                    onClick={() => handleLevelClick(item.level)}
                                    disabled={!!matches[item.level]}
                                    className={\`w-full p-4 rounded-xl text-left font-bold transition-all border-l-4 shadow-sm
                                        ${matches[item.level] ? 'bg-green-50 border-green-500 text-green-700 opacity-50' : 
                                          selectedLevel === item.level ? 'bg-indigo-100 border-indigo-500 text-indigo-800 scale-105 shadow-md' : 'bg-white border-gray-300 hover:bg-gray-50 text-gray-700'}
                                    \`}
                                >
                                    {item.level}
                                </button>
                            ))}
                        </div>

                        <div className="space-y-4">
                            <h3 className="font-bold text-gray-400 uppercase text-sm">Méthode Active</h3>
                            {[...matchData].sort(() => Math.random() - 0.5).map((item) => {
                                const isMatched = Object.values(matches).includes(item.method);
                                return (
                                    <button
                                        key={item.method}
                                        onClick={() => handleMethodClick(item.method)}
                                        disabled={isMatched}
                                        className={\`w-full p-4 rounded-xl text-left font-bold transition-all border-r-4 shadow-sm flex items-center gap-3
                                            ${isMatched ? 'bg-green-50 border-green-500 text-green-700' : 'bg-white border-gray-300 hover:bg-gray-50 text-gray-700 hover:border-indigo-300'}
                                        \`}
                                    >
                                        <div className="p-2 bg-indigo-50 rounded-lg text-indigo-600"><Icon name={item.iconName} size={20}/></div>
                                        {item.method}
                                    </button>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        const Level3Scenario = ({ onComplete }) => {
            const [index, setIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [feedback, setFeedback] = useState(null);

            useLucideRefresh([index, feedback]);

            const handleOption = (option) => {
                if(feedback) return;
                const isCorrect = option.correct;
                setFeedback({
                    correct: isCorrect,
                    text: option.feedback
                });
                if (isCorrect) setScore(s => s + 1);
            };

            const nextScenario = () => {
                setFeedback(null);
                if (index < scenarios.length - 1) {
                    setIndex(i => i + 1);
                } else {
                    onComplete(score, scenarios.length);
                }
            };

            const sc = scenarios[index];

            return (
                <div className="max-w-2xl mx-auto pt-10 px-4">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold text-gray-800 flex items-center gap-2"><Icon name="briefcase" className="text-blue-500"/> Phase 3 : Le Consultant</h2>
                        <span className="font-bold text-blue-600">{index + 1}/{scenarios.length}</span>
                    </div>

                    <div className="bg-white rounded-3xl shadow-xl overflow-hidden">
                        <div className="bg-slate-800 p-6 text-white">
                            <h3 className="text-xl font-bold mb-2 flex items-center gap-2"><Icon name="users" size={20}/> {sc.context}</h3>
                            <p className="opacity-80 text-sm">{sc.detail}</p>
                        </div>
                        
                        <div className="p-8">
                            {!feedback ? (
                                <>
                                    <h4 className="text-lg font-bold text-gray-800 mb-6">{sc.question}</h4>
                                    <div className="space-y-3">
                                        {sc.options.map((opt, i) => (
                                            <button 
                                                key={i} 
                                                onClick={() => handleOption(opt)}
                                                className="w-full text-left p-4 rounded-xl border-2 border-gray-100 hover:border-blue-500 hover:bg-blue-50 transition font-medium text-gray-700"
                                            >
                                                {opt.text}
                                            </button>
                                        ))}
                                    </div>
                                </>
                            ) : (
                                <div className="text-center animate-pop">
                                    <div className={\`inline-block p-3 rounded-full mb-4 ${feedback.correct ? 'bg-green-100' : 'bg-red-100'}\`}>
                                        {feedback.correct ? <Icon name="check" size={32} className="text-green-600"/> : <Icon name="x" size={32} className="text-red-600"/>}
                                    </div>
                                    <h3 className={\`text-xl font-bold mb-2 ${feedback.correct ? 'text-green-700' : 'text-red-700'}\`}>
                                        {feedback.correct ? "Excellent choix" : "Pas tout à fait"}
                                    </h3>
                                    <p className="text-gray-600 mb-6">{feedback.text}</p>
                                    <Button onClick={nextScenario} variant="primary">Suivant</Button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const FinalScore = ({ totalScore, maxScore, onRestart }) => {
            const percentage = Math.round((totalScore / maxScore) \* 100);
            
            useLucideRefresh();

            return (
                <div className="flex flex-col items-center justify-center min-h-screen p-6 text-center bg-white">
                    <Icon name="award" size={80} className="text-yellow-500 mb-6 animate-bounce" />
                    <h1 className="text-4xl font-bold text-gray-800 mb-2">Bilan de Compétence</h1>
                    <div className="text-6xl font-black text-blue-600 mb-4">{percentage}%</div>
                    <p className="text-gray-500 mb-8 max-w-md mx-auto">
                        {percentage > 80 ? 
                            "Bravo ! Vous avez parfaitement intégré la grille de critères et l'alignement pédagogique." : 
                            "Bon début ! Relisez la section sur l'alignement 'Objectifs - Méthodes' pour viser l'excellence."}
                    </p>

                    <div className="bg-gray-50 rounded-xl p-6 max-w-lg w-full mb-8 text-left">
                        <h3 className="font-bold text-gray-700 mb-4 border-b pb-2">Les Clés du Module 5 :</h3>
                        <ul className="space-y-3">
                            <li className="flex items-start gap-3">
                                <span className="bg-blue-100 text-blue-600 rounded-full w-6 h-6 flex items-center justify-center font-bold text-xs shrink-0">1</span>
                                <span className="text-sm text-gray-600"><strong>Cœur de la méthode :</strong> L'apprenant est ACTEUR (il manipule, résout, produit).</span>
                            </li>
                            <li className="flex items-start gap-3">
                                <span className="bg-blue-100 text-blue-600 rounded-full w-6 h-6 flex items-center justify-center font-bold text-xs shrink-0">2</span>
                                <span className="text-sm text-gray-600"><strong>L'alignement C2 :</strong> L'objectif dicte la méthode. (Ex: "Appliquer" = Atelier pratique).</span>
                            </li>
                            <li className="flex items-start gap-3">
                                <span className="bg-blue-100 text-blue-600 rounded-full w-6 h-6 flex items-center justify-center font-bold text-xs shrink-0">3</span>
                                <span className="text-sm text-gray-600"><strong>Débriefing :</strong> Indispensable pour transformer l'expérience en apprentissage durable.</span>
                            </li>
                        </ul>
                    </div>

                    <Button onClick={onRestart} variant="primary">
                        Recommencer le Labo
                    </Button>
                </div>
            );
        };

        const App = () => {
            const [step, setStep] = useState('intro');
            const [totalScore, setTotalScore] = useState(0);
            const [maxScore, setMaxScore] = useState(0);

            const addToScore = (points, max) => {
                setTotalScore(s => s + points);
                setMaxScore(m => m + max);
            };

            const goToLevel2 = (s, m) => { addToScore(s, m); setStep('level2'); };
            const goToLevel3 = (s, m) => { addToScore(s, m); setStep('level3'); };
            const finishGame = (s, m) => { addToScore(s, m); setStep('score'); };

            const restart = () => {
                setTotalScore(0);
                setMaxScore(0);
                setStep('intro');
            };

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-900 selection:bg-blue-100 selection:text-blue-900">
                    {step === 'intro' && <Intro onStart={() => setStep('level1')} />}
                    {step === 'level1' && <Level1Sorter onComplete={goToLevel2} />}
                    {step === 'level2' && <Level2Matcher onComplete={goToLevel3} />}
                    {step === 'level3' && <Level3Scenario onComplete={finishGame} />}
                    {step === 'score' && <FinalScore totalScore={totalScore} maxScore={maxScore} onRestart={restart} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
